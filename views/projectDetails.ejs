<!DOCTYPE html>

<html lang="zh-CN">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->

    <title>
        <%= title %>
    </title>
    <link rel='stylesheet' href='https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css' />
    <link rel='stylesheet' href='/stylesheets/dashboard.css' />
    <!-- table -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">
    <!--select -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/css/bootstrap-select.min.css">

    <style>
        .item-content{
            display: none;
        }
        .subitem-content{
            display: none;
        }
    </style>
</head>

<body>

    <% include nav.ejs %>

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 col-md-2 sidebar">
                <ul class="nav nav-sidebar">
                    <li class="nav-item project-nav"><a href="#" onclick='projectClick();return false;'>项目信息 </a></li>
                    <li class="nav-item version-nav"><a href="#" onclick='versionClick();return false;'>管理版本</a></li>
                    <li class="nav-item demand-nav"><a href="#" onclick='demandClick();return false;'>管理需求</a></li>
                    
                </ul>
                <ul class="nav nav-sidebar">
                    <li class="nav-item mission-nav"><a href="#" onclick='missionClick();return false;'>管理任务</a></li>
                    <li class="nav-item bug-nav"><a href="#" onclick='bugClick();return false;'>管理BUG</a></li>
                    <li class="nav-item member-nav"><a href="#" onclick='memberClick();return false;'>管理人员</a></li>
                </ul>
            </div>

            <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
                <div class="item-content item-project">
                    <h2 class="sub-header">项目信息</h2>
                    <div class="row ">
                        <div class="col-md-1"></div>
                        <div class="col-md-8">
                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label for="pjName" class="col-sm-2 control-label">项目名称</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="pjName" placeholder="项目名称" value ="<%= project.name %>">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="pjId" class="col-sm-2 control-label">项目编号</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" id="pjId" placeholder="项目编号" value ="<%= project.id %>" readonly>
                                        <input type="hidden" id="pid" value='<%= project.id %>'>
                                        <input type="hidden" id="pstate" value='<%= project.state %>'>
                                        <input type="hidden" id="pendtime" value='<%= project.endtime %>'>
                                        <input type="hidden" id="pjauth" value='<%= session.pjauth %> '>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="pjDesc" class="col-sm-2 control-label">项目描述</label>
                                    <div class="col-sm-8">
                                        <textarea class="form-control" rows="5" id="pjDesc" placeholder="项目描述"><%= project.p_desc %></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label"></label>
                                    <div class="col-sm-8 row">
                                        <div class=" col-xs-6 col-xs-offset-3">
                                            <button type="button" class="btn btn-success btn-block" onclick="updateProject();">提交</button>
                                        </div>
                                        
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                </div>
                
                <div class="item-content item-version">
                    <h2 class="sub-header">管理版本</h2>
                    <div id="versiontoolbar" class="btn-group">
                        <button id="btn_add" type="button" class="btn btn-default" data-toggle="modal" data-target="#addVersionModal">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增版本
                        </button>
                        <button id="btn_update" type="button" class="btn btn-default" data-toggle="modal" data-target="#updateVersionModal">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改版本
                        </button>
                        <button id="btn_add_vmession" type="button" class="btn btn-default" data-toggle="modal" data-target="#addVMissionModal">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增任务
                        </button>
                    </div>
                    
                    <table id="versionList"></table>

                    <div class="modal fade" id="addVersionModal" tabindex="-1" role="dialog" >
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">新增版本</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <form class="form-horizontal" id="addVersionFrom">
                                                <div class="form-group">
                                                    <label for="vName" class="col-sm-2 control-label">版本代号</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="vName" placeholder="版本代号">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="vpctime" class="col-sm-2 control-label">计划开始</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="vpctime" placeholder="计划开始">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="vpetime" class="col-sm-2 control-label">计划结束</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="vpetime" placeholder="计划结束">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="vdesc" class="col-sm-2 control-label">版本描述</label>
                                                    <div class="col-sm-8">
                                                        <textarea class="form-control" rows="5" id="vdesc" placeholder="版本描述"></textarea>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="col-md-1">

                                        </div>

                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="addVersion();">提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="updateVersionModal" tabindex="-1" role="dialog" >
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">修改版本</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <form class="form-horizontal" id="mdVersionFrom">
                                                <div class="form-group">
                                                    <label for="mdvName" class="col-sm-2 control-label">版本代号</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="mdvName" placeholder="版本代号">
                                                        <input type="hidden" class="form-control" id="mdvid" placeholder="版本代号">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="mdvstate" class="col-sm-2 control-label">版本状态</label>
                                                    <div class="col-sm-8">
                                                        <label class="radio-inline">
                                                            <input type="radio" name="mdvstate" id="mdvstate" value="0" > 未开始
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="mdvstate" id="mdvstate" value="1"> 进行中
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="mdvstate" id="mdvstate" value="2"> 已完成
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="mdvstate" id="mdvstate" value="3"> 版本暂停
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="mdvstate" id="mdvstate" value="4"> 版本作废
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="mdvpctime" class="col-sm-2 control-label">计划开始</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="mdvpctime" placeholder="计划开始">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="mdvpetime" class="col-sm-2 control-label">计划结束</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="mdvpetime" placeholder="计划结束">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="mdvdesc" class="col-sm-2 control-label">版本描述</label>
                                                    <div class="col-sm-8">
                                                        <textarea class="form-control" rows="5" id="mdvdesc" placeholder="版本描述"></textarea>
                                                        <div class="hidden">
                                                            <textarea class="form-control" rows="5" id="mdvobj" placeholder="所选版本对象"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="updateVersion();">提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="addVMissionModal" tabindex="-1" role="dialog" >
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">新增任务</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <form class="form-horizontal" id="vamFrom">
                                                    <div class="form-group ">
                                                        <label for="vamName" class="col-sm-2 control-label">任务名称</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" id="vamName" placeholder="任务名称" >
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="vampstime" class="col-sm-2 control-label">计划开始</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" id="vampstime" placeholder="计划开始">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="vampetime" class="col-sm-2 control-label">计划结束</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" id="vampetime" placeholder="计划结束">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="vamtype" class="col-sm-2 control-label">任务类型</label>
                                                        <div class="col-sm-8">
                                                            <label class="radio-inline">
                                                                <input type="radio" name="vamtype" id="vamtype" value="3" checked> 开发
                                                            </label>
                                                            <label class="radio-inline">
                                                                <input type="radio" name="vamtype" id="vamtype" value="4"> 测试
                                                            </label>
                                                            <label class="radio-inline">
                                                                <input type="radio" name="vamtype" id="vamtype" value="5"> 产品/运营/需求
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="vamvid" class="col-sm-2 control-label">所属版本</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" id="vamVNAME" placeholder="所属版本名称" readonly>
                                                            <input type="hidden" class="form-control" id="vamvid" placeholder="所属版本ID">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="vamDesc" class="col-sm-2 control-label">任务描述</label>
                                                        <div class="col-sm-8">
                                                            <textarea class="form-control" rows="5" id="vamDesc" placeholder="任务描述"></textarea>
                                                        </div>
                                                    </div>
                                            </form>

                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="vamCommit();" >提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>     
                </div>

                <div class="item-content item-demand">
                    <h2 class="sub-header">管理需求</h2>
                    <div id="demandtoolbar" class="btn-group">
                        <button id="btn_add_demand" type="button" class="btn btn-default" data-toggle="modal" data-target="#adddmModal">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增需求
                        </button>
                        <button id="btn_update_demand" type="button" class="btn btn-default" data-toggle="modal" data-target="#updatedmModal">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改需求
                        </button>
                        <button id="btn_add_dmession" type="button" class="btn btn-default" data-toggle="modal" data-target="#addDMissionModal">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增任务
                        </button>
                    </div>

                    <table id="demandList"></table>
                    
                    <div class="modal fade" id="adddmModal" tabindex="-1" role="dialog" >
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">新增需求</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <form class="form-horizontal" id="demandaddFrom">
                                                <div class="form-group">
                                                    <label for="dmName" class="col-sm-2 control-label">需求名称</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="dmName" placeholder="需求名称">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="dmID" class="col-sm-2 control-label">需求编号</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="dmID" placeholder="需求编号-自动生成" readonly>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="dmDesc" class="col-sm-2 control-label">需求描述</label>
                                                    <div class="col-sm-8">
                                                        <textarea class="form-control" rows="5" id="dmDesc" placeholder="需求描述"></textarea>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="col-md-1">
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="dmAddCommit();">提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>        
                    </div>
                    
                    <div class="modal fade" id="updatedmModal" tabindex="-1" role="dialog" >
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">修改需求</h4>
                                </div>
                                <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-1"></div>
                                            <div class="col-md-10">
                                                <form class="form-horizontal" id="demandmdFrom">
                                                    <div class="form-group">
                                                        <label for="dmmdName" class="col-sm-2 control-label">需求名称</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" id="dmmdName" placeholder="需求名称">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="dmmdID" class="col-sm-2 control-label">需求编号</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" id="dmmdID" placeholder="需求编号-自动生成" readonly>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="dmmdstate" class="col-sm-2 control-label">任务类型</label>
                                                        <div class="col-sm-8">
                                                            <label class="radio-inline">
                                                                        <input type="radio" name="dmmdstate" id="dmmdstate" value="2" > 已完成
                                                                    </label>
                                                            <label class="radio-inline">
                                                                        <input type="radio" name="dmmdstate" id="dmmdstate" value="3"> 暂停开发
                                                                    </label>
                                                            <label class="radio-inline">
                                                                        <input type="radio" name="dmmdstate" id="dmmdstate" value="4"> 异常问题
                                                                    </label>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="dmmdDesc" class="col-sm-2 control-label">需求描述</label>
                                                        <div class="col-sm-8">
                                                            <textarea class="form-control" rows="5" id="dmmdDesc" placeholder="需求描述"></textarea>
                                                            <div class="hidden">
                                                                <textarea class="form-control" rows="5" id="dmmdobj" placeholder="修改前需求对象"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div class="col-md-1">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary" onclick="dmmdCommit();">提交</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    </div>
                            </div>
                        </div>    
                    </div>

                    <div class="modal fade" id="addDMissionModal" tabindex="-1" role="dialog" >
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">新增任务</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <form class="form-horizontal" id="adddmMSFrom">
                                                <div class="form-group ">
                                                    <label for="dmmsname" class="col-sm-2 control-label">任务名称</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="dmmsname" placeholder="任务名称">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="dmmspstime" class="col-sm-2 control-label">计划开始</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="dmmspstime" placeholder="计划开始">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="dmmspetime" class="col-sm-2 control-label">计划结束</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="dmmspetime" placeholder="计划结束">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="dmmstype" class="col-sm-2 control-label">任务类型</label>
                                                    <div class="col-sm-8">
                                                        <label class="radio-inline">
                                                            <input type="radio" name="dmmstype" id="dmmstype" value="3" checked> 开发
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="dmmstype" id="dmmstype" value="4"> 测试
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="dmmstype" id="dmmstype" value="5"> 产品/运营/需求
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="dmmsvid" class="col-sm-2 control-label">所属版本</label>
                                                    <div class="col-sm-8">
                                                        <select id="dmverslist" title="请选择所属版本" name="dmverslist" class="selectpicker show-tick form-control" data-live-search="false">
                                                            <% for (var i=0; i<vslist.length; i++) { %>
                                                                <option value="<%=vslist[i].id %>" > <%=vslist[i].name %></option>    
                                                            <% } %>  
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="dmmsName" class="col-sm-2 control-label">所属需求</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="dmmsName" placeholder="需求名称" readonly>
                                                        <input type="hidden" class="form-control" id="dmmsid" placeholder="需求编号">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="dmmsdesc" class="col-sm-2 control-label">任务描述</label>
                                                    <div class="col-sm-8">
                                                        <textarea class="form-control" rows="5" id="dmmsdesc" placeholder="任务描述"></textarea>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="msdmAddCommit();">提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="item-content item-mission">
                    <h2 class="sub-header">管理任务</h2>
                    <div id="missiontoolbar" class="btn-group">
                        <button id="btn_add_mission" type="button" class="btn btn-default" data-toggle="modal" data-target="#addmsModal">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增任务
                        </button>
                        <button id="btn_update_mission" type="button" class="btn btn-default" data-toggle="modal" data-target="#updatemsModal">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改任务
                        </button>
                        <button id="btn_del_mission" type="button" class="btn btn-default" data-toggle="modal" data-target="#delmsModal">
                            <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>删除任务
                        </button>
                    </div>

                    <table id="msList"></table>

                    <div class="modal fade" id="addmsModal" tabindex="-1" role="dialog" >
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">新增任务</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <form class="form-horizontal" id="addMSFrom">
                                                <div class="form-group ">
                                                    <label for="msname" class="col-sm-2 control-label">任务名称</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="msname" placeholder="任务名称">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="mspstime" class="col-sm-2 control-label">计划开始</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="mspstime" placeholder="计划开始">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="mspetime" class="col-sm-2 control-label">计划结束</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="mspetime" placeholder="计划结束">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="mstype" class="col-sm-2 control-label">任务类型</label>
                                                    <div class="col-sm-8">
                                                        <label class="radio-inline">
                                                                    <input type="radio" name="mstype" id="mstype" value="3" checked> 开发
                                                                </label>
                                                        <label class="radio-inline">
                                                                    <input type="radio" name="mstype" id="mstype" value="4"> 测试
                                                                </label>
                                                        <label class="radio-inline">
                                                                    <input type="radio" name="mstype" id="mstype" value="5"> 产品/运营/需求
                                                                </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msvid" class="col-sm-2 control-label">所属版本</label>
                                                    <div class="col-sm-8">
                                                        <select id="verslist" title="请选择所属版本" name="verslist" class="selectpicker show-tick form-control" data-live-search="false">
                                                            <% for (var i=0; i<vslist.length; i++) { %>
                                                                <option value="<%=vslist[i].id %>" > <%=vslist[i].name %></option>    
                                                            <% } %>  
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msdid" class="col-sm-2 control-label">所属需求</label>
                                                    <div class="col-sm-8">
                                                        <select id="dmlist" title="请选择所属需求" name="dmlist" class="selectpicker show-tick form-control" data-live-search="false">
                                                            <% for (var i=0; i<dmlist.length; i++) { %>
                                                                <option value="<%=dmlist[i].id %>" > <%=dmlist[i].name %></option>    
                                                            <% } %>     
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msdesc" class="col-sm-2 control-label">任务描述</label>
                                                    <div class="col-sm-8">
                                                        <textarea class="form-control" rows="5" id="msdesc" placeholder="任务描述"></textarea>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="msAddCommit();">提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="updatemsModal" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">修改任务</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <form class="form-horizontal" id="updateMSFrom">
                                                <div class="form-group ">
                                                    <label for="msmdname" class="col-sm-2 control-label">任务名称</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="msmdname" placeholder="任务名称">
                                                        <input type="hidden" class="form-control" id="msmdid" placeholder="任务编号">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msmdpstime" class="col-sm-2 control-label">计划开始</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="msmdpstime" placeholder="计划开始">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msmdpetime" class="col-sm-2 control-label">计划结束</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" class="form-control" id="msmdpetime" placeholder="计划结束">
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msmdtype" class="col-sm-2 control-label">任务类型</label>
                                                    <div class="col-sm-8">
                                                        <label class="radio-inline">
                                                                    <input type="radio" name="msmdtype" id="msmdtype" value="3" > 开发
                                                                </label>
                                                        <label class="radio-inline">
                                                                    <input type="radio" name="msmdtype" id="msmdtype" value="4"> 测试
                                                                </label>
                                                        <label class="radio-inline">
                                                                    <input type="radio" name="msmdtype" id="msmdtype" value="5"> 产品/运营/需求
                                                                </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msmdstate" class="col-sm-2 control-label">任务状态</label>
                                                    <div class="col-sm-8">
                                                        <label class="radio-inline">
                                                            <input type="radio" name="msmdstate" id="msmdstate" value="0" > 正常
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="msmdstate" id="msmdstate" value="1"> 延期
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="msmdstate" id="msmdstate" value="2"> 异常
                                                        </label>
                                                        <label class="radio-inline">
                                                            <input type="radio" name="msmdstate" id="msmdstate" value="2"> 过期
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msmdvid" class="col-sm-2 control-label">所属版本</label>
                                                    <div class="col-sm-8">
                                                        <select id="mdverslist" title="请选择所属版本" name="mdverslist" class="selectpicker show-tick form-control" data-live-search="false">
                                                            <% for (var i=0; i<vslist.length; i++) { %>
                                                                <option value="<%=vslist[i].id %>" > <%=vslist[i].name %></option>    
                                                            <% } %>  
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msmddid" class="col-sm-2 control-label">所属需求</label>
                                                    <div class="col-sm-8">
                                                        <select id="mddmlist" title="请选择所属需求" name="mddmlist" class="selectpicker show-tick form-control" data-live-search="false">
                                                            <% for (var i=0; i<dmlist.length; i++) { %>
                                                                <option value="<%=dmlist[i].id %>" > <%=dmlist[i].name %></option>    
                                                            <% } %>     
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="msmddesc" class="col-sm-2 control-label">任务描述</label>
                                                    <div class="col-sm-8">
                                                        <textarea class="form-control" rows="5" id="msmddesc" placeholder="任务描述"></textarea>
                                                        <div class="hidden">
                                                            <textarea class="form-control" rows="5" id="msmdobj" placeholder="任务对象JSON" disabled="disabled"></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form> 
                                        </div>
                                        <div class="col-md-1"></div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="msMdCommit();">提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="delmsModal" tabindex="-1" role="dialog">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">删除任务</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10"></div>
                                        <div class="col-md-1"></div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary">提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="item-content item-bug">
                    <h2 class="sub-header">管理BUG</h2>

                </div>

                <div class="item-content item-member">
                    <h2 class="sub-header">管理人员</h2>
                    <ul class="nav nav-tabs">
                        <li role="presentation" class="subnav-item pm-nav"><a href="#" onclick="pmClick(2);return false;">PM-负责人</a></li>
                        <li role="presentation" class="subnav-item de-nav"><a href="#" onclick="deClick(3);return false;">DE-开发人员</a></li>
                        <li role="presentation" class="subnav-item te-nav"><a href="#" onclick="teClick(4);return false;">TE-测试人员</a></li>
                        <li role="presentation" class="subnav-item da-nav"><a href="#" onclick="daClick(5);return false;">DA-运营人员/产品人员</a></li>
                    </ul>
                    
                    <div>
                        <!-- 空行 -->
                        <p>&nbsp;</p>
                        <input type ="hidden" id="gidSelected" value="">
                    </div>

                    <div id="grouptoolbar" class="btn-group">
                        <button id="btn_add_member" type="button" class="btn btn-default" data-toggle="modal" data-target="#addGroupmbModal">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增成员
                        </button>
                        <button id="btn_update_member" type="button" class="btn btn-default" data-toggle="modal" data-target="#delGroupmbModal">
                            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>删除成员
                        </button>
                        <button id="btn_dispense_ms" type="button" class="btn btn-default" data-toggle="modal" data-target="#dispenseMSModal">
                            <span class="glyphicon glyphicon-user" aria-hidden="true"></span>分配任务
                        </button>
                    </div>
                    <table id="groupList"></table>

                    <div class="modal fade" id="addGroupmbModal" tabindex="-1" role="dialog" >
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">新增成员</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <div class="table-responsive">
                                                <table class="table ">
                                                    <tbody id="addMemt">
                                                        <tr>
                                                            <td> <input type="checkbox"> C罗</td>
                                                            <td> <input type="checkbox"> 本泽马</td>
                                                            <td> <input type="checkbox"> 贝尔</td>
                                                            <td> <input type="checkbox"> 阿森西奥</td>
                                                        </tr>
                                                        <tr>
                                                            <td><input type="checkbox"> 克洛斯</td>
                                                            <td><input type="checkbox"> 莫德里奇</td> 
                                                            <td><input type="checkbox"> 卡塞米罗</td>
                                                            <td><input type="checkbox"> 伊斯科</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="col-md-1">

                                        </div>

                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="addMemeber();">提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal fade" id="delGroupmbModal" tabindex="-1" role="dialog" >
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title">删除成员</h4>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-1"></div>
                                        <div class="col-md-10">
                                            <p>该成员如果存在正在进行的任务，会导致删除失败</p>
                                            <input type="hidden" id="delMemberid" value="">  
                                        </div>
                                        <div class="col-md-1">
                                        </div>

                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" onclick="delMemeber();">提交</button>
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="dispenseMSModal" tabindex="-1" role="dialog" >
                            <div class="modal-dialog modal-lg" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span></button>
                                        <h4 class="modal-title">分配任务</h4>
                                        <input type="hidden" id = "dispenseId" value ="">
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-1"></div>
                                            <div class="col-md-10">
                                                <div class="table-responsive">
                                                    <table class="table  form-group">
                                                        <label class="control-label">已接任务</label>
                                                        <tbody id="delMSt">
                                                            <tr>
                                                                <td> <input type="checkbox" id="checkbox1"> <label title="版本1" for="checkbox1" >C罗</label></td>
                                                                <td> <input type="checkbox" id="checkbox1"> <label title="版本1" for="checkbox1" >C罗</label></td>
                                                                <td> <input type="checkbox" id="checkbox1"> <label title="版本1" for="checkbox1" >C罗</label></td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                    <table class="table form-group">
                                                        <label class="control-label">可接任务</label>
                                                        <tbody id="addMSt">
                                                            <td> <input type="checkbox" id="checkbox1"> <label title="版本1" for="checkbox1" >C罗</label></td>
                                                            <td> <input type="checkbox" id="checkbox1"> <label title="版本1" for="checkbox1" >C罗</label></td>
                                                            <td> <input type="checkbox" id="checkbox1"> <label title="版本1" for="checkbox1" >C罗</label></td>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="col-md-1">
    
                                            </div>
    
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary" onclick="dispenseMS();">提交</button>
                                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--select -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/bootstrap-select.min.js"></script>
    <!-- table -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/locale/bootstrap-table-zh-CN.min.js"></script>
    <!-- date -->
    <script src="/javascripts/laydate/laydate.js"></script>

    <script>
        //界面显示控制

        function projectClick() {
            $(".nav-item").removeClass('active');
            $(".project-nav").addClass('active');
            $('.item-content').hide();
            $('.item-project').show();
        }
        
        function versionClick() {
            $(".nav-item").removeClass('active');
            $(".version-nav").addClass('active');
            $('.item-content').hide();
            $('.item-version').show();

            var pid = $('#pid').val();
            //销毁表格
            $("#versionList").bootstrapTable('destroy'); 
            //新建表格
            var vtable = new Versiontable();
            vtable.Init(pid);
        }

        function demandClick() {
            $(".nav-item").removeClass('active');
            $(".demand-nav").addClass('active');
            $('.item-content').hide();
            $('.item-demand').show();

            var pid = $('#pid').val();
            //销毁表格
            $("#versionList").bootstrapTable('destroy'); 
            //新建表格
            var dtable = new Demandtable();
            dtable.Init(pid);
        }

        function missionClick() {
            $(".nav-item").removeClass('active');
            $(".mission-nav").addClass('active');
            $('.item-content').hide();
            $('.item-mission').show();

            var pid = $('#pid').val();
            //销毁表格
            $("#versionList").bootstrapTable('destroy'); 
            //新建表格
            var mtable = new Messiontable();
            mtable.Init(pid);
        }

        function bugClick() {
            $(".nav-item").removeClass('active');
            $(".bug-nav").addClass('active');
            $('.item-content').hide();
            $('.item-bug').show();
        }

        function memberClick() {
            $(".nav-item").removeClass('active');
            $(".member-nav").addClass('active');
            $('.item-content').hide();
            $('.item-member').show();

            pmClick(2);
        }

        //清除select 选择方法
        function cleanSelect(){
            $('.selectpicker').selectpicker('deselectAll');
        }

        //检查是否有修改的权限
        function checkAUTH(index){
            var auth = $('#pjauth').val();

            if(auth.length > 0){
                auth = auth.split(',');
            }else{
                return false;
            }

            //分割后数组中元素为字符串
            if(auth.indexOf(String(index)) == -1){
                return false;
            }else{
                return true;
            }


        }

    </script>

    <script>
        $(function () {
            projectClick();
        });
    </script>

    <script>
        //修改项目信息 
        function updateProject(){
            var pjName = $('#pjName').val();
            var pid = $('#pid').val();
            var pjDesc = $("#pjDesc").val();
            var pstate = $('#pstate').val();
            var pendtime = $('#pendtime').val();

            var submitData = {
                'id': pid,
                'name': pjName,
                'state':pstate,
                'endtime':pendtime,
                'desc': pjDesc
            };

            //id 丢失
            if(pid == null ||pid == '' || pid == undefined){
                alert('页面信息缺失，请刷新页面，重新修改！');
                return ;
            }

            if(!checkAUTH(2)){
                alert('不具备修改项目信息的权限!只有PM可以修改！');
                return ;
            }

            $.ajax({
                url: '/project/update',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {

                    if (result.success) {
                        alert('修改成功');
                        //刷新页面
                        window.location.href = "/project/pjdetails?pid="+pid;
                        
                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后注册');
                }
            });
        }

    </script>

    <script>
        //管理版本

        //版本列表
        function Versiontable() {
            this.Init = function (pid) {
                $('#versionList').bootstrapTable({
                    url: '/project/getAllversion',
                    method: 'get',
                    queryParams: function queryParams(params) {   //设置查询参数  
                        var param = {
                            limit: params.limit,    //页面大小
                            offset: params.offset,  //页码
                            order: params.order,     //排序
                            pid: pid  //所属项目
                        };
                        return param;
                    },
                    toolbar: '#versiontoolbar',              //工具按钮用哪个容器
                    checkboxHeader: false,              //设置false 将在列头隐藏check-all checkbox .
                    striped: true,                      //是否显示行间隔色
                    cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                    pagination: true,                   //是否显示分页（*）
                    sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1,                      //初始化加载第一页，默认第一页
                    pageSize: 10,                       //每页的记录行数（*）
                    pageList: [10, 20, 50],             //可供选择的每页的行数（*）
                    showColumns: true,                  //是否显示所有的列
                    showRefresh: true,                  //是否显示刷新按钮
                    minimumCountColumns: 2,             //最少允许的列数
                    clickToSelect: true,                //是否启用点击选中行
                    singleSelect: true,                  //只能选中一行
                    height: 570,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                    uniqueId: "id",                     //每一行的唯一标识，一般为主键列
                    columns: [
                        {
                            checkbox: true
                        },
                        {
                            field: 'id',
                            title: '版本编号',
                            visible:false
                        }, {
                            field: 'name',
                            title: '版本代号',
                        }, {
                            field: 'state',
                            title: '版本状态',
                            formatter: function (data) {
                                if (data == 0) {
                                    return "未开始";
                                } else if (data == 1) {
                                    return "进行中";
                                } else if (data == 2) {
                                    return "已完成";
                                } else if (data == 3) {
                                    return "版本暂停";
                                } else if (data == 4) {
                                    return "版本作废";
                                }
                            }
                        }, {
                            field: 'v_desc',
                            title: '版本描述'
                        }, {
                            field: 'pctime',
                            title: '计划开始时间',
                            formatter: function (data) {
                                var timestr = new Date(data * 1000).Format("yyyy-MM-dd");

                                return timestr;
                            }
                        }, {
                            field: 'petime',
                            title: '计划结束时间',
                            formatter: function (data) {
                                var timestr = new Date(data * 1000).Format("yyyy-MM-dd");

                                return timestr;
                            }
                        } ,{
                            field: 'actime',
                            title: '实际开始时间',
                            formatter: function (data) {
                                var timestr = new Date(data * 1000).Format("yyyy-MM-dd");

                                return timestr;
                            },
                            visible:false
                        },{
                            field: 'aetime',
                            title: '实际结束时间',
                            formatter: function (data) {
                                var timestr = new Date(data * 1000).Format("yyyy-MM-dd");

                                return timestr;
                            },
                            visible:false
                        }]
                });
            }
        }

        //添加版本
        function addVersion() {
            var vName = $('#vName').val();
            var vpctime = $('#vpctime').val();
            var vpetime = $('#vpetime').val();
            var vdesc = $('#vdesc').val();
            var pid = $('#pid').val();

            var submitData = {
                'pid': pid,
                'vName': vName,
                'vpctime': vpctime,
                'vpetime': vpetime,
                'vdesc': vdesc,
            };

            if(!checkAUTH(2)){
                alert('不具备修改增加版本的权限!只有PM可以修改！');
                return ;
            }

            $.ajax({
                url:'/project/addVersion',
                type:'POST',
                async:true,
                dataType:'json',
                data:submitData,
                success:function(result){
                    if(result.success){
                        //关闭窗口
                        $('#addVersionModal').modal('hide');
                        //刷新列表
                        $("#versionList").bootstrapTable('refresh');

                    }else{
                        alert(result.msg);
                    }
                },
                error:function(error){
                   alert('系统异常，请稍后再添加');
                }
            });
        }

        //修改版本信息
        function updateVersion(){
            var vid = $('#mdvid').val();
            var vName = $('#mdvName').val();
            var vstate = $("input[name='mdvstate']:checked").val();
            var vpctime = $('#mdvpctime').val();
            var vpetime = $('#mdvpetime').val();
            var vdesc = $('#mdvdesc').val();
            var oldobj = $('#mdvobj').val();

            
            var submitData = {
                'id': vid,
                'vName': vName,
                'vstate':vstate,
                'vpctime': vpctime,
                'vpetime': vpetime,
                'vdesc': vdesc,
                'oldobj':oldobj
            };

            //id 丢失
            if(vid == null ||vid == '' || vid == undefined){
                alert('页面信息缺失，请关闭之后，重新修改！');
                return ;
            }

            if(!checkAUTH(2)){
                alert('不具备修改版本信息的权限!只有PM可以修改！');
                return ;
            }

            $.ajax({
                url: '/version/update',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {

                    if (result.success) {
                        alert('修改成功！');
                        //关闭窗口
                        $('#updateVersionModal').modal('hide');
                        //刷新列表
                        $("#versionList").bootstrapTable('refresh');

                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后修改');
                }
            });
        }

        //添加版本模态框赋值
        $('#addVersionModal').on('show.bs.modal', function (event) {
            //表单重置
            document.getElementById('addVersionFrom').reset();

            laydate.render({
                elem: '#vpetime'
            });

            laydate.render({
                elem: '#vpctime'
            });


        });

        //修改版本模态框赋值
        $('#updateVersionModal').on('show.bs.modal', function (event) {
            var $vtable = $('#versionList');
            var selectData = $vtable.bootstrapTable('getSelections');
            var modal = $(this);
            //是否有选择用户判断
            var flag = selectData == '';

            //表单重置
            document.getElementById('mdVersionFrom').reset();

            laydate.render({
                elem: '#mdvpctime',
                value: new Date(selectData[0].pctime * 1000).Format("yyyy-MM-dd")
            });

            laydate.render({
                elem: '#mdvpetime',
                value: new Date(selectData[0].petime * 1000).Format("yyyy-MM-dd")
            });


            if ((!flag) && selectData[0].id != null&&selectData[0].state <2) {
                //selectData[0].state <2
                //版本需要状态为0，或者1 可修改

                modal.find('#mdvName').val(selectData[0].name);
                modal.find('#mdvid').val(selectData[0].id);
                modal.find('input[name="mdvstate"][value="'+selectData[0].state+'"]').attr("checked",true);  
                modal.find('#mdvdesc').val(selectData[0].v_desc);
                modal.find('#mdvobj').val(JSON.stringify(selectData[0]));
                
            }else{
                return false;
            }
        });

        //添加任务模态框赋值
        $('#addVMissionModal').on('show.bs.modal', function (event) {
            var $vtable = $('#versionList');
            var selectData = $vtable.bootstrapTable('getSelections');
            var modal = $(this);
            //是否有选择用户判断
            var flag = selectData == '';

            //表单重置
            document.getElementById('vamFrom').reset();

            laydate.render({
                elem: '#vampetime'
            });

            laydate.render({
                elem: '#vampstime'
            });

            if ((!flag) && selectData[0].id != null) {
                modal.find('#vamVNAME').val(selectData[0].name);
                modal.find('#vamvid').val(selectData[0].id);
            }else{
                return false;
            }
        });

        //版本页面 增加任务
        function vamCommit(){
            var vamName = $('#vamName').val();
            var vampstime = $('#vampstime').val();
            var vampetime = $('#vampetime').val();
            var vamtype = $("input[name='vamtype']:checked").val();
            var vamvid = $('#vamvid').val();
            var vamDesc = $('#vamDesc').val();
            var vampid = $('#pid').val();

            //时间控件 格式为 yyyy-mm-dd 需转为数字 ，单位秒
            vampstime = Math.floor(new Date(vampstime).getTime()/1000);
            vampetime = Math.floor(new Date(vampetime).getTime()/1000);
            
            var submitData = {
                'name': vamName,
                'pstime': vampstime,
                'petime': vampetime,
                'type': vamtype,
                'vid': vamvid,
                'desc': vamDesc,
                'pid':vampid
            };

            if(!checkAUTH(2)){
                alert('不具备添加任务的权限!只有PM可以添加！');
                return ;
            }

            $.ajax({
                url: '/mission/add',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {

                    if (result.success) {
                        alert('添加成功');
                        //关闭窗口
                        $('#addVMissionModal').modal('hide');
                        
                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后注册');
                }
            });
        };
    </script>

    <script> 
        //管理需求

        //需求列表
        function Demandtable() {
            this.Init = function (pid) {
                $('#demandList').bootstrapTable({
                    url: '/project/getAlldm',
                    method: 'get',
                    queryParams: function queryParams(params) {   //设置查询参数  
                        var param = {
                            limit: params.limit,    //页面大小
                            offset: params.offset,  //页码
                            order: params.order,     //排序
                            pid: pid  //所属项目
                        };
                        return param;
                    },
                    toolbar: '#demandtoolbar',              //工具按钮用哪个容器
                    checkboxHeader: false,              //设置false 将在列头隐藏check-all checkbox .
                    striped: true,                      //是否显示行间隔色
                    cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                    pagination: true,                   //是否显示分页（*）
                    sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1,                      //初始化加载第一页，默认第一页
                    pageSize: 10,                       //每页的记录行数（*）
                    pageList: [10, 20, 50],             //可供选择的每页的行数（*）
                    showColumns: true,                  //是否显示所有的列
                    showRefresh: true,                  //是否显示刷新按钮
                    minimumCountColumns: 2,             //最少允许的列数
                    clickToSelect: true,                //是否启用点击选中行
                    singleSelect: true,                  //只能选中一行
                    height: 570,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                    uniqueId: "id",                     //每一行的唯一标识，一般为主键列
                    columns: [
                        {
                            checkbox: true
                        },
                        {
                            field: 'id',
                            title: '版本编号',
                            visible:false
                        }, {
                            field: 'name',
                            title: '需求名称',
                        }, {
                            field: 'state',
                            title: '需求状态',
                            formatter: function (data) {
                                if (data == 0) {
                                    return "未分解";
                                } else if (data == 1) {
                                    return "进行中";
                                } else if(data == 2 ){
                                    return "已完成";
                                }else if(data == 3 ){
                                    return "暂停开发";
                                }else if(data == 4 ){
                                    return "异常问题";
                                }
                            }
                        }, {
                            field: 'd_desc',
                            title: '需求描述'
                        }]
                });
            }
        }

        //创建需求模态框赋值
        $('#adddmModal').on('show.bs.modal', function (event) {
            document.getElementById("demandaddFrom").reset()  
        });

        //修改需求模态框赋值
        $('#updatedmModal').on('show.bs.modal', function (event) {
            var $mtable = $('#demandList');
            var selectData = $mtable.bootstrapTable('getSelections');
            var modal = $(this);

            document.getElementById("demandmdFrom").reset();  

            //是否有选择用户判断
            var flag = selectData == '';

            if ((!flag) && selectData[0].id != null) {
               //个人信息赋值
                modal.find('#dmmdName').val(selectData[0].name);
                modal.find('#dmmdID').val(selectData[0].id);
                modal.find('input[name="dmmdstate"][value="'+selectData[0].state+'"]').attr("checked",true);  
                modal.find('#dmmdDesc').val(selectData[0].d_desc);
                modal.find('#dmmdobj').val(JSON.stringify(selectData[0]));

            }else{
                return false;
            }

            
        });

        //需求页面创建任务模态框赋值
        $('#addDMissionModal').on('show.bs.modal', function (event) {
            var $mtable = $('#demandList');
            var selectData = $mtable.bootstrapTable('getSelections');
            var modal = $(this);

            cleanSelect();
            document.getElementById("adddmMSFrom").reset() ; 

            laydate.render({
                elem: '#dmmspstime'
            });

            laydate.render({
                elem: '#dmmspetime'
            });

            //是否有选择用户判断
            var flag = selectData == '';

            if ((!flag) && selectData[0].id != null && selectData[0].state <2) {
                //selectData[0].state <2
                //需求状态为未分解，或者进行中的，可以关联创建任务

               //个人信息赋值
                modal.find('#dmmsName').val(selectData[0].name);
                modal.find('#dmmsid').val(selectData[0].id);

            }else{
                return false;
            }
        });

        //添加需求
        function dmAddCommit() {
            var dmpid = $('#pid').val();

            var dmName = $('#dmName').val();
            var dmID = Math.floor(new Date().getTime()/1000);
            var dmDesc = $('#dmDesc').val();

            var submitData = {
                'pid': dmpid,
                'dmName': dmName,
                'dmID': dmID,
                'dmDesc': dmDesc
            };

            if(checkAUTH(2) || checkAUTH(5)){
                //是产品或者 PM，能改没毛病
            }else{
                alert('不具备新增需求的权限!只有PM / 产品人员可以新增！');
                return ;
            }

            $.ajax({
                url: '/project/addDemand',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {
                    if (result.success) {
                        //关闭窗口
                        $('#adddmModal').modal('hide');
                        //刷新列表
                        $("#demandList").bootstrapTable('refresh');

                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后添加需求');
                }
            });
        }

        //修改需求
        function dmmdCommit(){
            var dmmdName = $('#dmmdName').val();
            var dmmdID = $('#dmmdID').val();
            var dmmdDesc = $('#dmmdDesc').val();
            var dmmdstate = $("input[name='dmmdstate']:checked").val();
            var dmmdobj = $('#dmmdobj').val();

            //id 丢失
            if(dmmdID == null ||dmmdID == '' || dmmdID == undefined){
                alert('页面信息缺失，请关闭之后，重新修改！');
                return ;
            }

            if(checkAUTH(2) || checkAUTH(5)){
                //是产品或者 PM，能改没毛病
            }else{
                alert('不具备新增需求的权限!只有PM / 产品人员可以修改！');
                return ;
            }

            var submitData = {
                'dmName': dmmdName,
                'dmID': dmmdID,
                'dmDesc': dmmdDesc,
                'dmState':dmmdstate,
                'oldobj':dmmdobj
            };

            $.ajax({
                url: '/demand/update',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {

                    if (result.success) {
                        alert('修改成功！');
                        //关闭窗口
                        $('#updatedmModal').modal('hide');
                        //刷新列表
                        $("#demandList").bootstrapTable('refresh');

                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后修改');
                }
            });
            
        }

        //需求页添加任务
        function msdmAddCommit(){
            var msname = $('#dmmsname').val();
            var mspstime = $('#dmmspstime').val();
            var mspetime = $('#dmmspetime').val();
            var mstype = $("input[name='dmmstype']:checked").val();
            var msvid = $('#dmverslist').val();
            var msdid = $('#dmmsid').val();
            var msdesc = $('#dmmsdesc').val();
            var mspid = $('#pid').val();

            //时间控件 格式为 yyyy-mm-dd 需转为数字 ，单位秒
            mspstime = Math.floor(new Date(mspstime).getTime()/1000);
            mspetime = Math.floor(new Date(mspetime).getTime()/1000);
            
             //不可为空
            if(msvid == null){
                alert('请选择所属版本！');
                return ;
            }

            if(!checkAUTH(2)){
                alert('不具备添加任务的权限!只有PM可以添加！');
                return ;
            }
        
            var submitData = {
                'name': msname,
                'pstime': mspstime,
                'petime': mspetime,
                'type': mstype,
                'vid': msvid,
                'did': msdid,
                'desc': msdesc,
                'pid': mspid
            };

            $.ajax({
                url: '/mission/add',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {

                    if (result.success) {
                        alert('添加成功');
                        //关闭窗口
                        $('#addDMissionModal').modal('hide');
                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后注册');
                }
            });
        }
    </script>

    <script>
        //管理任务

        //任务列表
        function Messiontable(){
            this.Init = function(pid){
                $('#msList').bootstrapTable({
                    url: '/mission/getMS',
                    method: 'get',
                    queryParams: function queryParams(params) {   //设置查询参数  
                        var param = {
                            limit: params.limit,    //页面大小
                            offset: params.offset,  //页码
                            order: params.order,     //排序
                            pid: pid  //所属项目
                        };
                        return param;
                    },
                    toolbar: '#missiontoolbar',         //工具按钮用哪个容器
                    checkboxHeader: false,              //设置false 将在列头隐藏check-all checkbox .
                    striped: true,                      //是否显示行间隔色
                    cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                    pagination: true,                   //是否显示分页（*）
                    sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1,                      //初始化加载第一页，默认第一页
                    pageSize: 10,                       //每页的记录行数（*）
                    pageList: [10, 20, 50],             //可供选择的每页的行数（*）
                    showColumns: true,                  //是否显示所有的列
                    showRefresh: true,                  //是否显示刷新按钮
                    minimumCountColumns: 2,             //最少允许的列数
                    clickToSelect: true,                //是否启用点击选中行
                    singleSelect: true,                  //只能选中一行
                    height: 570,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                    uniqueId: "id",                     //每一行的唯一标识，一般为主键列
                    columns: [
                        {
                            checkbox: true
                        },{
                            field: 'name',
                            title: '任务名称',
                        },{
                            field: 'state',
                            title: '任务状态',
                            formatter: function (data) {
                                if (data == 0) {
                                    return "正常";
                                } else if (data == 1) {
                                    return "延期";
                                } else if (data == 2) {
                                    return "异常";
                                } else if (data == 3) {
                                    return "过期";
                                } 
                            }
                        }, {
                            field: 'status',
                            title: '任务进度',
                            formatter: function (data) {
                                if (data == 0) {
                                    return "未开始";
                                } else if (data == 1) {
                                    return "进行中";
                                } else if (data == 2) {
                                    return "已完成";
                                } else if (data == 3) {
                                    return "暂停";
                                } 
                            }
                        }, {
                            field: 'type',
                            title: '任务类型',
                            formatter: function (data) {
                                if (data == 3) {
                                    return "开发";
                                } else if (data == 4) {
                                    return "测试";
                                } else if (data == 5) {
                                    return "产品/运营/需求";
                                } 
                            }
                        }, {
                            field: 'pstime',
                            title: '计划开始时间',
                            formatter: function (data) {
                                if(data == -1){
                                    return '-';
                                }else{
                                    var timestr = new Date(data * 1000).Format("yyyy-MM-dd");
    
                                    return timestr;
                                }
                            }
                        }, {
                            field: 'petime',
                            title: '计划结束时间',
                            formatter: function (data) {

                                if(data == -1){
                                    return '-'
                                }else{
                                    var timestr = new Date(data * 1000).Format("yyyy-MM-dd");
    
                                    return timestr;
                                }

                            }
                        },{
                            field: 'm_desc',
                            title: '任务描述',
                        },{
                            field: 'id',
                            title: '任务编号',
                            visible:false
                        }, {
                            field: 'pid',
                            title: '所属项目',
                            visible:false
                        },{
                            field: 'did',
                            title: '所属需求',
                            visible:false
                        },{
                            field: 'vid',
                            title: '所属版本',
                            visible:false
                        },{
                            field: 'owner',
                            title: '所属员工',
                            visible:false
                        },{
                            field: 'astime',
                            title: '实际开始时间',
                            formatter: function (data) {
                                if(data == -1){
                                    return '-';
                                }else{
                                    var timestr = new Date(data * 1000).Format("yyyy-MM-dd");
    
                                    return timestr;
                                }
                            },
                            visible:false
                        },{
                            field: 'aetime',
                            title: '实际结束时间',
                            formatter: function (data) {
                                if(data == -1){
                                    return '-';
                                }else{
                                    var timestr = new Date(data * 1000).Format("yyyy-MM-dd");
    
                                    return timestr;
                                }
                            },
                            visible:false
                        }]
                });
            }
        }

         //创建任务模态框赋值
         $('#addmsModal').on('show.bs.modal', function (event) {
            cleanSelect();
            document.getElementById("addMSFrom").reset() ;
            
            laydate.render({
                elem: '#mspstime'
            });

            laydate.render({
                elem: '#mspetime'
            });
        });

        //创建任务模态框赋值
        $('#updatemsModal').on('show.bs.modal', function (event) {
            var $mtable = $('#msList');
            var selectData = $mtable.bootstrapTable('getSelections');
            var modal = $(this);

            cleanSelect();
            document.getElementById("updateMSFrom").reset();  

            laydate.render({
                elem: '#msmdpstime',
                value: new Date(selectData[0].pstime* 1000).Format("yyyy-MM-dd")
            });

            laydate.render({
                elem: '#msmdpetime',
                value: new Date(selectData[0].petime* 1000).Format("yyyy-MM-dd")
            });

            //是否有选择用户判断
            var flag = selectData == '';

            if ((!flag) && selectData[0].id != null) {
               //个人信息赋值
                modal.find('#msmdid').val(selectData[0].id);
                modal.find('#msmdname').val(selectData[0].name);
                modal.find('input[name="msmdtype"][value="'+selectData[0].type+'"]').attr("checked",true);  
                modal.find('input[name="msmdstate"][value="'+selectData[0].state+'"]').attr("checked",true);  
                modal.find('#msmddesc').val(selectData[0].m_desc);

                $('#mddmlist').selectpicker('val', selectData[0].did);
                $('#mdverslist').selectpicker('val', selectData[0].vid);

                modal.find('#msmdobj').val(JSON.stringify(selectData[0]));

            }else{
                return false;
            }

            
        });

        //添加任务
        function msAddCommit() {
            var msname = $('#msname').val();
            var mspstime = $('#mspstime').val();
            var mspetime = $('#mspetime').val();
            var mstype = $("input[name='mstype']:checked").val();
            var msvid = $('#verslist').val();
            var msdid = $('#dmlist').val();
            var msdesc = $('#msdesc').val();
            var mspid = $('#pid').val();

            mspstime = Math.floor(new Date(mspstime).getTime() / 1000);
            mspetime = Math.floor(new Date(mspetime).getTime() / 1000);

            //不可为空
            if(msvid == null){
                alert('请选择所属版本！');
                return ;
            }

            if(!checkAUTH(2)){
                alert('不具备添加任务的权限!只有PM可以添加！');
                return ;
            }
        
            var submitData = {
                'name': msname,
                'pstime': mspstime,
                'petime': mspetime,
                'type': mstype,
                'vid': msvid,
                'did': msdid,
                'desc': msdesc,
                'pid': mspid
            };

            $.ajax({
                url: '/mission/add',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {

                    if (result.success) {
                        alert('添加成功');
                        //关闭窗口
                        $('#addmsModal').modal('hide');
                        //刷新列表
                        $("#msList").bootstrapTable('refresh');
                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后注册');
                }
            });
        }

        //修改任务
        function msMdCommit(){
            var msmdid = $('#msmdid').val();
            var msmdname = $('#msmdname').val();
            var msmdpstime = $('#msmdpstime').val();
            var msmdpetime = $('#msmdpetime').val();
            var msmdtype = $("input[name='msmdtype']:checked").val();
            var msmdstate = $("input[name='msmdstate']:checked").val();
            var msmdvid = $('#mdverslist').val();
            var msmddid = $('#mddmlist').val();
            var msmddesc = $('#msmddesc').val();
            var mspid = $('#pid').val();
            var oldobj = $('#msmdobj').val();

            msmdpstime = Math.floor(new Date(msmdpstime).getTime() / 1000);
            msmdpetime = Math.floor(new Date(msmdpetime).getTime() / 1000);

            //不可为空
            if(msmdvid == null){
                alert('请选择所属版本！');
                return ;
            }
            //id 丢失
            if(msmdid == null ||msmdid == '' || msmdid == undefined){
                alert('页面信息缺失，请关闭之后，重新修改！');
                return ;
            }

            if(!checkAUTH(2)){
                alert('不具备修改任务的权限!只有PM可以修改！');
                return ;
            }

            var submitData = {
                'id':msmdid,
                'name': msmdname,
                'pstime': msmdpstime,
                'petime': msmdpetime,
                'type': msmdtype,
                'state':msmdstate,
                'vid': msmdvid,
                'did': msmddid,
                'desc': msmddesc,
                'pid': mspid,
                'oldobj':oldobj
            };

            $.ajax({
                url: '/mission/update',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {

                    if (result.success) {
                        alert('修改成功！');
                        //关闭窗口
                        $('#updatemsModal').modal('hide');
                        //刷新列表
                        $("#msList").bootstrapTable('refresh');

                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后修改');
                }
            });
        }

    </script>

    <script>
    //管理BUG
    </script>

    <script>
        //管理人员

        //页签导航条
        function pmClick(index){
            $(".subnav-item").removeClass('active');
            $(".pm-nav").addClass('active');

            var pid = $('#pid').val();
            $('#gidSelected').val(index);
            //销毁表格
            $("#groupList").bootstrapTable('destroy'); 
            //新建表格
            var gtable = new Grouptable();
            gtable.Init(index,pid);
           
        }

        function deClick(index){
            $(".subnav-item").removeClass('active');
            $(".de-nav").addClass('active');

            var pid = $('#pid').val();
            $('#gidSelected').val(index);
            //销毁表格
            $("#groupList").bootstrapTable('destroy'); 
            //新建表格
            var gtable = new Grouptable();
            gtable.Init(index,pid);
    
        }

        function teClick(index){
            $(".subnav-item").removeClass('active');
            $(".te-nav").addClass('active');

            var pid = $('#pid').val();
            $('#gidSelected').val(index);
            //销毁表格
            $("#groupList").bootstrapTable('destroy'); 
            //新建表格
            var gtable = new Grouptable();
            gtable.Init(index,pid);
        }

        function daClick(index){
            $(".subnav-item").removeClass('active');
            $(".da-nav").addClass('active');
           
            var pid = $('#pid').val();
            $('#gidSelected').val(index);
            //销毁表格
            $("#groupList").bootstrapTable('destroy'); 
            //新建表格
            var gtable = new Grouptable();
            gtable.Init(index,pid);
        }

        //成员列表
        function Grouptable() {
            this.Init = function (index,pid) {
                $('#groupList').bootstrapTable({
                    url: '/group/getMembers',
                    method: 'get',
                    queryParams: function queryParams(params) {   //设置查询参数  
                        var param = {
                            limit: params.limit,    //页面大小
                            offset: params.offset,  //页码
                            order: params.order,     //排序
                            index: index,  //所属组别
                            pid:pid        //所属项目
                        };
                        return param;
                    },
                    toolbar: '#grouptoolbar',              //工具按钮用哪个容器
                    checkboxHeader: false,              //设置false 将在列头隐藏check-all checkbox .
                    striped: true,                      //是否显示行间隔色
                    cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                    pagination: true,                   //是否显示分页（*）
                    sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                    pageNumber: 1,                      //初始化加载第一页，默认第一页
                    pageSize: 5,                       //每页的记录行数（*）
                    pageList: [5, 10, 20],             //可供选择的每页的行数（*）
                    showColumns: true,                  //是否显示所有的列
                    showRefresh: true,                  //是否显示刷新按钮
                    minimumCountColumns: 1,             //最少允许的列数
                    clickToSelect: true,                //是否启用点击选中行
                    singleSelect: true,                  //只能选中一行
                    height: 350,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                    uniqueId: "id",                     //每一行的唯一标识，一般为主键列
                    columns: [
                        {
                            checkbox: true
                        },
                        {
                            field: 'uid',
                            title: '人员编号',
                            visible:false
                        }, {
                            field: 'nickname',
                            title: '姓名',
                        },{
                            field: 'pid',
                            title: '项目编号',
                            visible:false
                        },{
                            field: 'gid',
                            title: '组编号',
                            visible:false
                        }]
                });
            }
        }

        //添加成员模态框内容生成
        $('#addGroupmbModal').on('show.bs.modal', function (event) {
            $('#addMemt').empty();

            var pid = $('#pid').val();
            var gid = $('#gidSelected').val();
            
            $.get("/group/addMemberbefore?gid=" + gid+ "&pid=" +pid, function (result) {
                if(result.success){
                    var data = result.data;

                    var values = "<tr>";
                    for(var i =0 ;i< data.length ;i++){
                        var temp = data[i];
                        values += "<td> <input type='checkbox' name='addMember'  value ='"+temp.uid+"'>"+temp.nickname+"</td>";
                        if(i == data.length-1){
                            values +='<tr>';
                            break;
                        }
                        if( (i+1) % 4 == 0){
                            values += "</tr>";
                            if(i != data.length-1){
                                values +='<tr>';
                            }
                        }
                    }
                    $('#addMemt').append(values);
                }else{
                    $('#addMemt').append('<tr><td>没有人员可以再添加</td></tr>');
                }
            });    
        });
        //删除成员模态框内容生成
        $('#delGroupmbModal').on('show.bs.modal', function (event) {
            var $mtable = $('#groupList');
            var selectData = $mtable.bootstrapTable('getSelections');
            var modal = $(this);

            //是否有选择用户判断
            var flag = selectData == '';

            if ((!flag) && selectData[0].uid != null) {
                modal.find('#delMemberid').val(selectData[0].uid);
            }else{
                return false;
            }
        });
        //分配任务模态框内容生成
        $('#dispenseMSModal').on('show.bs.modal', function (event) {
            var $mtable = $('#groupList');
            var selectData = $mtable.bootstrapTable('getSelections');
            var modal = $(this);
            var pid = $('#pid').val();
            var gid = $('#gidSelected').val();

            //是否有选择用户判断
            var flag = selectData == '';

            if ((!flag) && selectData[0].uid != null) {

                if(gid == 2){
                    //负责人不承担任务
                    return false ;
                }
                $('#delMSt').empty();
                $('#addMSt').empty();

                modal.find('#dispenseId').val(selectData[0].uid);

                $.get("/group/dispensebefore?gid=" + gid+ "&pid=" +pid+"&uid="+selectData[0].uid, function (result) {
                    var accept = result.accept;
                    var noaccept = result.noaccept;

                    //已结任务
                    var values = "<tr>";
                    if(accept.length == 0){
                        values +='<td>没有可以撤销分配的任务</td></tr>';
                    }else{
                        for (var i = 0; i < accept.length; i++) {
                            var temp = accept[i];
                            values += "<td> <input type='checkbox' name='undepMs' id='undepMS"+i+"'  value ='" + temp.id + "'>" ;
                            values += "<label title='"+temp.vname+"' for='undepMS"+i+"' >"+temp.mname+"</label></td>";
                            if (i == accept.length - 1) {
                                values += '<tr>';
                                break;
                            }
                            if ((i+1) % 3 == 0) {
                                values += "</tr>";
                                if (i != accept.length - 1) {
                                    values += '<tr>';
                                }
                            }
                        }
                    }
                    $('#delMSt').append(values);

                    //待接任务
                    var values = "<tr>";
                    if(noaccept.length == 0){
                        values +='<td>没有可以分配的任务</td></tr>';
                    }else{
                        for (var i = 0; i < noaccept.length; i++) {
                            var temp = noaccept[i];
                            values += "<td> <input type='checkbox' name='depMs' id='depMS"+i+"'  value ='" + temp.id + "'>" ;
                            values += "<label title='"+temp.vname+"' for='depMS"+i+"' >"+temp.mname+"</label></td>";
                            if (i == noaccept.length - 1) {
                                values += '<tr>';
                                break;
                            }
                            if ( (i+1) % 3 == 0) {
                                values += "</tr>";
                                if (i != noaccept.length - 1) {
                                    values += '<tr>';
                                }
                            }
                        }
                    }
                    $('#addMSt').append(values);

                });
            }else{
                return false;
            }
        });
        //添加成员
        function addMemeber(){
           var checked = [];
           //获取选中值
           $("input[name='addMember']:checked").each(function () {
                checked.push( parseInt(this.value));
            }); 

            if(checked.length == 0){
                //没选中添加，瞎点
                $('#addGroupmbModal').modal('hide');

                return;
            }

            if(!checkAUTH(2)){
                alert('不具备添加组员的权限!只有PM可以添加！');
                return ;
            }

            var pid = $('#pid').val();
            var gid = $('#gidSelected').val();
            var checkArr = checked.join(',');

            var submitData ={
                pid:pid,
                gid:gid,
                checkArr:checkArr
            }

            $.ajax({
                url: '/group/addMemeber',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {
                    if (result.success) {
                        //关闭窗口
                        $('#addGroupmbModal').modal('hide');
                        //刷新列表
                        $("#groupList").bootstrapTable('refresh');

                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后添加需求');
                }
            });

        }
        //删除成员
        function delMemeber(){
            var pid = $('#pid').val();
            var gid = $('#gidSelected').val();
            var delMemberid = $('#delMemberid').val();
            
            if(!checkAUTH(2)){
                alert('不具备删除组员的权限!只有PM可以删除！');
                return ;
            }

            var submitData ={
                pid:pid,
                gid:gid,
                delid:delMemberid
            }

            $.ajax({
                url: '/group/delMemeber',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {
                    if (result.success) {
                        //关闭窗口
                        $('#delGroupmbModal').modal('hide');
                        //刷新列表
                        $("#groupList").bootstrapTable('refresh');

                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后添加需求');
                }
            });
        }
        //分配任务
        function dispenseMS(){
            var udchecked = [];
           //获取选中值
           $("input[name='undepMs']:checked").each(function () {
               udchecked.push( parseInt(this.value));
            }); 

            var dchecked = [];
            $("input[name='depMs']:checked").each(function () {
                dchecked.push( parseInt(this.value));
            }); 

            var pid = $('#pid').val();
            var gid = $('#gidSelected').val();
            var dispenseId = $('#dispenseId').val();

            if(udchecked.length == 0 && dchecked.length == 0){
                //啥都没选，提交个屁
                $('#dispenseId').modal('hide');
                return;
            }

            if(!checkAUTH(2)){
                alert('不具备分配任务的权限!只有PM可以分配！');
                return ;
            }

            var submitData ={
                pid:pid,
                gid:gid,
                dispenseId:dispenseId,
                udchecked:udchecked.join(','),
                dchecked:dchecked.join(',')
            }

            $.ajax({
                url: '/group/dispenseMS',
                type: 'POST',
                async: true,
                dataType: 'json',
                data: submitData,
                success: function (result) {

                    if (result.success) {
                        //关闭窗口
                        $('#dispenseMSModal').modal('hide');
                        
                    } else {
                        alert(result.msg);
                    }
                },
                error: function (error) {
                    alert('系统异常，请稍后添加需求');
                }
            });

        }

    </script>


</body>

</html>